buildscript {
	repositories {
		mavenCentral()
	}
	dependencies {
		classpath 'org.kt3k.gradle.plugin:coveralls-gradle-plugin:2.4.0'
	}
}

plugins {
  id "org.sonarqube" version "1.1"
  id "java"
  id "jacoco"
  id "com.github.kt3k.coveralls" version "2.4.0x"
}

version = '1.2-SNAPSHOT'

allprojects {
	buildDir = "/tmp/${rootProject.name}/${project.name}"
}

repositories {
	mavenCentral()
}

jacoco {
    toolVersion = "0.7.5.201505241946"
}

jacocoTestReport {
	description = "Generate Jacoco coverage reports after running tests."
    reports {
        xml {
            enabled true
            destination "${buildDir}/reports/jacoco/test/jacocoTestReport.xml"
        }

        csv.enabled false

        html {
            enabled true
            destination "${buildDir}/reports/jacoco/test/html"
        }
    }
}

dependencies {
	compile group: 'com.google.code.gson', name: 'gson', version: '2.+'
	testCompile group: 'junit', name: 'junit', version: '4.+'
}

task sourcesJar(type: Jar, dependsOn: classes) {
	classifier = 'sources'
	archiveName = jar.baseName +'-' + classifier + '.' + jar.extension
	from sourceSets.main.allSource
}

javadoc {
	configure(options) {
		links = ['http://docs.oracle.com/javase/7/docs/api/']
		bottom = 'Copyright &copy; 2014-2014 <a href=\"http://www.hbm.com\" target=\"_blank\">Hottinger Baldwin Messtechnik GmbH</a>.'
		footer = 'HBM Device Scan API'
		header = 'HBM Device Scan API'
		options.overview = "src/main/doc/overview.html"
	}
	doLast {
		copy {
			from "src/main/doc/doc-files"
			into "$buildDir/docs/javadoc/doc-files"
		}
	}
}

task javadocJar(type: Jar, dependsOn: javadoc) {
	classifier = 'javadoc'
	archiveName = jar.baseName +'-' + classifier + '.' + jar.extension
	from javadoc.destinationDir
}

artifacts {
	archives sourcesJar
	archives javadocJar
}

jar {
	archiveName = jar.baseName + '.' + jar.extension
	from configurations.compile.collect { it.isDirectory() ? it : zipTree(it) }
	exclude ('fakemessages.properties')
	manifest {
		attributes \
			'Implementation-Title': 'HBM Device Scan Library', \
			'Implementation-Version': version, \
			'Implementation-Vendor': 'Hottinger Baldwin Messtechnik GmbH', \
			'Built-By': System.getProperty('user.name'), \
			'Built-JDK': System.getProperty('java.version'), \
			'Build-Time': new Date().format("yyyy-MM-dd'T'HH:mm:ssZ")
	}
}
